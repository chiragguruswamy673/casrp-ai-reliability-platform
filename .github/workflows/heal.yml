name: AI-Guided Healing Pipeline

on:
  workflow_dispatch:
    inputs:
      apply_fixes:
        description: "Approve AI-suggested fixes?"
        required: true
        default: "no"
        type: choice
        options:
          - yes
          - no

jobs:
  fetch-actions:
    runs-on: ubuntu-latest
    outputs:
      actions: ${{ steps.fetch.outputs.actions }}
    steps:
      - name: Fetch AI healing actions
        id: fetch
        run: |
          echo "actions=$(curl -s http://localhost:8000/twin/heal/actions)" >> $GITHUB_OUTPUT

  approval-gate:
    needs: fetch-actions
    runs-on: ubuntu-latest
    if: github.event.inputs.apply_fixes == 'yes'
    steps:
      - name: Approval received
        run: echo "Human approval granted. Proceeding with fixes."

  apply-fixes:
    needs: approval-gate
    runs-on: ubuntu-latest
    steps:
      - name: Apply approved fixes
        run: |
          echo "Applying AI-guided fixes..."
          echo "${{ needs.fetch-actions.outputs.actions }}"
